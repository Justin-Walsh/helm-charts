suite: "persistence"
templates:
- templates/nfs-statefulset.yaml
tests:
- it: "is not created when storageClassName has a value"
  set:
    persistence:
      storageClassName: "value"
  asserts:
  - hasDocuments:
      count: 0

- it: "should match snapshot"
  asserts:
  - matchSnapshot: {}

- it: sets the emptyDir size to be the value in values
  set:
    persistence:
      size: 100Gi
  asserts:
  - equal:
      path: spec.template.spec.volumes[?(@.name == 'octopus-volume')].emptyDir.sizeLimit
      value: 100Gi

- it: does not set serviceName if Release.IsInstall is false
  release:
    upgrade: true
  asserts:
  - notExists:
      path: spec.serviceName

- it: sets serviceName if Release.IsInstall is true
  release:
    upgrade: false
  asserts:
  - equal:
      path: spec.serviceName
      value: octopus-agent-nfs